---
title: "CASE 2 - Aanaesthetics"
author: Liam Phan, Michael Bigler, Tania Loureiro, William Elkiess, Dakota Cuellar
  and Ilyana El Mendili
date: "2023-03-10"
output: 
  rmdformats::downcute:
    code_folding: hide
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE,comment = FALSE, error = FALSE,options(scipen=999))
rm(list = ls())

```


<center>
![](Alpine.png)
</center>

# Client Case

> A study was carried out at a hospital to compare the effects of four different types of anaesthetic as used in major operations.
>
> 80 patients undergoing a variety of operations were randomly assigned to one of the four anaesthetics and a variety of observations were taken on each patient both before and after the operation.
>
> 1.  The client is interested on just one of the measurements made, namely the time, in minutes, from the reversal of the anaesthetic until the patient opened the eyes.
> 2.  The client would like to know if there is any evidence of differences between the effects of the four anaesthetics?

# Definitions

> **Anaesthesia means "loss of sensation". Medicines that cause anaesthesia are called anaesthetics.**
>
> Anaesthetics are used during tests and surgical operations to numb sensation in certain areas of the body or induce sleep.
>
> This prevents pain and discomfort, and enables a wide range of medical procedures to be carried out.
>
> Local anaesthetics and general anaesthetics are 2 commonly used types of anaesthetics:
>
> -   [local anaesthesia](https://www.nhs.uk/conditions/local-anaesthesia/) is where a small area of the body is numbed and you remain fully conscious -- often used during minor procedures
>
> -   [general anaesthesia](https://www.nhs.uk/conditions/general-anaesthesia/) is where you're totally unconscious and unaware of the procedure -- often used for more serious operations

# Packages

```{r Packages, include=FALSE}

library(ggplot2)
library(data.table)
library(tidyverse)
library(reshape)
library(DT)
library(car)

```

# Dataset

```{r Dataset}

Aanaesthetics <- fread("Aanaesthetics.txt")
Aanaesthetics <- as_data_frame(Aanaesthetics)

Aanaesthetics_Pivoted <- Aanaesthetics %>% 
  pivot_longer(
    cols = c("A","B","C","D"), 
    names_to = "Anaesthetic", 
    values_to = "Time")

Aanaesthetics_Pivoted$Patient <- seq(1,length(Aanaesthetics_Pivoted$Anaesthetic))

col_order <- c("Patient", "Time", "Anaesthetic")
Aanaesthetics_Pivoted <- Aanaesthetics_Pivoted[, col_order]

datatable(Aanaesthetics)
datatable(Aanaesthetics_Pivoted)
                              
```

# Analysis

## 1. Data Exploratory Analysis

```{r Summary Statistics}


```

### Outliers

```{r Outliers}

Weird_Patient <- Aanaesthetics_Pivoted[Aanaesthetics_Pivoted$Time == 0,]

datatable(Weird_Patient, caption = "Weird Patients")

Outliers <- Aanaesthetics_Pivoted[Aanaesthetics_Pivoted$Patient %in% c(41,30,31),]

datatable(Outliers, caption = "Outliers")

```

> Weird Patient having 0 minute recorded in the process... Need to talk about Data Collecting Phase !

### Boxplots

```{r Boxplots}

Boxplot <- ggplot(Aanaesthetics_Pivoted) +
 aes(x = Anaesthetic, y = Time, fill=Anaesthetic) +
 geom_boxplot() + scale_fill_manual(values=c("#435250", "#2F4F4E", "#0D8387", "#CBE4DE")) + labs(title = "Boxplots", subtitle = "Aanesthetics", caption = "©2023 Alpine Insights", y="Minutes") +  theme_minimal() + theme(plot.title = element_text(face = "bold")) + theme(legend.position = "none") + theme(axis.text.x=element_text(size=15,face = "bold")) + theme(axis.title = element_text(size =12))

Boxplot

```


### Histograms

```{r Histograms}

Histograms <- Aanaesthetics_Pivoted %>% ggplot( aes(x=Time, fill=Anaesthetic)) + geom_histogram( color="#e9ecef", alpha=1, position = 'identity', binwidth = 1) + scale_fill_manual(values=c("#2B3433", "#2F4F4E", "#0D8387", "#CBE4DE")) + theme_minimal() + labs(fill="") + facet_wrap(~Anaesthetic) + theme(plot.title = element_text(face = "bold")) + labs(title = "Histograms", subtitle = "Aanesthetics", caption = "©2023 Alpine Insights", y="Count") + theme(legend.position = "none") + theme(axis.title = element_text(size =12)) + theme(strip.text.x = element_text(size = 12,face = "bold"))         
Histograms

```


## 2. Core Analysis


### Anova Test

```{r Anova Test}

ANOVA <- aov(Time ~ Anaesthetic, data = Aanaesthetics_Pivoted)

ANOVA_Summary <- summary(ANOVA)

ANOVA_Summary

```

> P-Value Over 5% and 10%, We cannot reject Null Hypothessis, then they are all the same !

### Check Assumptions

> 1.  Homoskedasticity
>
> <!-- -->
>
> 2.  Normality

#### Anova Checks

```{r Anova Checks}

# Plot ANOVA Residuals
par(mfrow=c(2,2))
plot(ANOVA)
par(mfrow=c(1,1))

# Extract the residuals
ANOVA_Residuals <- residuals(object = ANOVA )

# Levene's Test
leveneTest(Time ~ Anaesthetic, data = Aanaesthetics_Pivoted)

# Run Shapiro-Wilk test
shapiro.test(x = ANOVA_Residuals )

# Kruskal-Wallis rank sum test, which can be used when ANNOVA assumptions are not met
kruskal.test(Time ~ Anaesthetic, data = Aanaesthetics_Pivoted)

```

> Some Outliers can deviate the result in Anova, Normality not very good, but Shapiro-Wilk Normality Test say it's normal, in case we don't believe this, we can use Kruskal-Wallis chi-squared and see p-value over 10% so same conclusions than ANOVA.

> From the output above we can see that the p-value is not less than the significance level of 0.05. This means that there is no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# Results

```{r Resuts}





```

```{r}
library(fitdistrplus)
descdist(Aanaesthetics$A, discrete = FALSE)
normal_dist <- fitdist(Aanaesthetics$A, "beta")
plot(normal_dist)

```

References

[One-Way ANOVA Test in R](http://www.sthda.com/english/wiki/one-way-anova-test-in-r)

[Anaesthesia](https://www.nhs.uk/conditions/anaesthesia/)
