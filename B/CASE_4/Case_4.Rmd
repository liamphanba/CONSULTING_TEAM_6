---
title: "CASE 4 - Teaching"
author: Liam Phan, Michael Bigler, Tania Loureiro, William Elkiess, Dakota Cuellar
  and Ilyana El Mendili
date: "2023-03-10"
output: 
  rmdformats::downcute:
    code_folding: hide
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE,comment = FALSE, error = FALSE,options(scipen=999))
rm(list = ls())

```

# Packages

```{r packages}
library(knitr) # html tables
library(gtsummary)
```

# Data Loading

```{r data loading}
teaching <- readxl::read_excel('Bteaching.xls')
teaching <- data.frame(teaching)
teaching$GROUP <- factor(teaching$GROUP, level = c('C', 'E'), labels = c('Control', 'Experiment'))
teaching$GENDER <- factor(teaching$GENDER, level = c('M', 'F'), labels =  c('Male', 'Female'))
teaching$PREF <- factor(teaching$PREF, level = c('A', 'N', 'T', 'K', 'V'), labels = c('A', 'N', 'T', 'K', 'V')) # get understandable lables
teaching$SLEVEL <- factor(teaching$SLEVEL, level = c('E', 'H'), labels = c('Elementary', 'Highschool'))
```

# Data exploratory

```{r exploratory}
kable(summary(teaching))
```

```{r}
teaching_strata <- tbl_strata(teaching, c('GROUP', 'SESSION'), )

table1 <- tbl_summary(
  teaching,
  by = GROUP, # split table by group
  missing = "no" # don't list missing data separately
) |> 
  add_n() |>  # add column with total number of non-missing observations
  add_p() |>  # test for a difference between groups
  modify_header(label = "**Variable**") |> # update the column header
  bold_labels() 
table1
```

```{r}
tbl_strata <-
  teaching |> 
  tbl_strata(
    strata = GROUP,
    .tbl_fun =
      ~ .x |>
        tbl_summary(by = SESSION, missing = "no") |>
      add_n() |>  # add column with total number of non-missing observations
      add_p() |>  # test for a difference between groups
      modify_header(label = "**Variable**") |> # update the column header
      bold_labels() ,
    .header = "**{strata}**, N = {n}"
  )
tbl_strata
```

# References {.unnumbered}

[gtsummary](https://www.danieldsjoberg.com/gtsummary/)

[Stratified gtsummary tables](https://www.danieldsjoberg.com/gtsummary/reference/tbl_strata.html)
